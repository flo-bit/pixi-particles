<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.1.0/pixi.min.js"></script>
    <script src="https://flo-bit.github.io/every-noise/noise.min.js"></script>
    <script src="./particles.js"></script>
  </head>
  <body style="overflow: hidden">
    <script>
      class PiXI_SCAFFOLD {
        constructor() {
          let w = window.innerWidth,
            h = window.innerHeight;

          this.app = new PIXI.Application({
            width: w,
            height: h,
            antialias: true,
            transparent: false,
            resolution: 1,
            backgroundColor: 0x000000,
          });
          this.keys = {};
          document.addEventListener("keydown", this.keyDown.bind(this));
          document.addEventListener("keyup", this.keyUp.bind(this));
          window.addEventListener("resize", this.windowResized.bind(this));

          this.setupScene();
          this.app.view.style.position = "absolute";
          this.app.view.style.top = "0px";
          this.app.view.style.left = "0px";

          document.body.appendChild(this.app.view);
          let ticker = PIXI.Ticker.shared;
          ticker.add(this.animate.bind(this));
        }

        setupScene() {
          /* setup your scene here */
          let radius =
            Math.min(this.app.screen.width, this.app.screen.height) / 3;
          /* START */
          this.particles = new Particles({
            renderer: this.app.renderer,
            particleSize: 2,
            //squares: true,
          });
          this.noise = new Noise({ scl: 0.008, oct: 3 });
          this.particles.forces.push((part) => {
            return {
              x: this.noise.get(part.x, part.y) * 5,
              y: 0,
            };
          });
          this.particles.x = this.app.screen.width / 2;
          this.particles.y = this.app.screen.height / 2;
          this.app.stage.addChild(this.particles);

          this.text = new PIXI.Text("1000", {
            fontFamily: "Arial",
            fontSize: 35,
            fill: 0xffffff,
            align: "left",
          });
          this.text.anchor.x = 1;
          this.text.x = window.innerWidth - 20;
          this.text.y = 10;
          this.app.stage.addChild(this.text);
          /* END */
        }
        animate() {
          /* Update your scene here */
          let elapsed = PIXI.Ticker.shared.elapsedMS / 1000.0;
          let total = PIXI.Ticker.shared.lastTime / 1000.0;

          /* START */
          this.particles.update(elapsed);
          this.particles.spawn({
            x: {
              min: -this.app.screen.width / 2,
              max: this.app.screen.width / 2,
            },
            y: -this.app.screen.height / 2,
            //y: (Math.random() - 0.5) * 400,
            //vx: () => (Math.random() - 0.5) * 200,
            vy: (p) => p.size * 100 + 50,
            lifetime: () => (Math.random() < 0.1 ? Math.random() * 5 : 0),
            //color: () => Math.random() * 0xff,
            alpha: () => Math.random() * 0.5 + 0.5,
            size: () => Math.pow(Math.random(), 3) * 2,
            count: 5,
            check: (p) => p.y > this.app.screen.height / 2,
          });

          this.text.text = this.particles.children.length;

          this.noise.shiftBy(0, 1);

          /* END */
        }

        windowResized() {
          this.app.renderer.resize(window.innerWidth, window.innerHeight);

          this.particles.x = this.app.screen.width / 2;
          this.particles.y = this.app.screen.height / 2;

          this.text.x = window.innerWidth - 20;
          this.text.y = 10;
        }
        keyDown(event) {
          this.keys[event.key] = true;
        }
        keyUp(event) {
          this.keys[event.key] = false;
        }
      }
      let app = new PiXI_SCAFFOLD();
    </script>
  </body>
</html>
